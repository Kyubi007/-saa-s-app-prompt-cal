{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/philippeichert/Downloads/saa-s-app-prompt-cal/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // Called from Server Component - middleware handles refresh\n        }\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,4DAA4D;gBAC9D;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/philippeichert/Downloads/saa-s-app-prompt-cal/app/api/apply-drafts/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { createClient } from \"@/lib/supabase/server\"\n\nexport async function POST(request: Request) {\n  const supabase = await createClient()\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n  }\n\n  const { draftIds } = await request.json()\n\n  if (!draftIds || !Array.isArray(draftIds)) {\n    return NextResponse.json({ error: \"Invalid draft IDs\" }, { status: 400 })\n  }\n\n  // Get all drafts\n  const { data: drafts, error: fetchError } = await supabase\n    .from(\"event_drafts\")\n    .select(\"*\")\n    .in(\"id\", draftIds)\n    .eq(\"user_id\", user.id)\n\n  if (fetchError || !drafts) {\n    return NextResponse.json({ error: \"Failed to fetch drafts\" }, { status: 500 })\n  }\n\n  const results = []\n\n  for (const draft of drafts) {\n    try {\n      if (draft.type === \"create\") {\n        // Create new event\n        const { data, error } = await supabase\n          .from(\"events\")\n          .insert({\n            user_id: user.id,\n            title: draft.title,\n            start_at: draft.start_at,\n            duration_min: draft.duration_min,\n            notes: draft.notes,\n            source: \"ai\",\n            status: \"confirmed\",\n            confidence: draft.confidence,\n          })\n          .select()\n          .single()\n\n        if (error) throw error\n        results.push({ draft_id: draft.id, event: data, action: \"created\" })\n      } else if (draft.type === \"update\" && draft.target_event_id) {\n        // Update existing event\n        const updateData: Record<string, unknown> = {}\n        if (draft.title) updateData.title = draft.title\n        if (draft.start_at) updateData.start_at = draft.start_at\n        if (draft.duration_min) updateData.duration_min = draft.duration_min\n        if (draft.notes) updateData.notes = draft.notes\n\n        const { data, error } = await supabase\n          .from(\"events\")\n          .update(updateData)\n          .eq(\"id\", draft.target_event_id)\n          .eq(\"user_id\", user.id)\n          .select()\n          .single()\n\n        if (error) throw error\n        results.push({ draft_id: draft.id, event: data, action: \"updated\" })\n      } else if (draft.type === \"delete\" && draft.target_event_id) {\n        // Delete event\n        const { error } = await supabase.from(\"events\").delete().eq(\"id\", draft.target_event_id).eq(\"user_id\", user.id)\n\n        if (error) throw error\n        results.push({ draft_id: draft.id, action: \"deleted\" })\n      }\n\n      // Delete the draft after applying\n      await supabase.from(\"event_drafts\").delete().eq(\"id\", draft.id).eq(\"user_id\", user.id)\n    } catch (error) {\n      console.error(`Error applying draft ${draft.id}:`, error)\n    }\n  }\n\n  return NextResponse.json({ results })\n}\n"],"names":[],"mappings":"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"}}]
}